<!DOCTYPE html>
<html>
<head>
<title>Memoframe Replay</title>
<script src="https://code.jquery.com/jquery-2.1.4.min.js"></script>
<style>
html, body
{
  height: 100%;
  margin: 0px;
  padding: 0px;
  border: 0px;
  overflow: hidden;
}

iframe
{
  position: absolute;
  width: 100%;
  height: 100%;
}

.header
{
  text-align: center;
  padding: 8px;
  font-size: 20px;
}

.header * {
  font-size: 20px;
}

</style>
</head>
<body>
<div class="header">
Date/Time:
<input id="ts" type="text" value="{{ ts }}"></input>
<input id="update" type="button" value="Update"></input>
</div>
<div id="currLabel" class="header">
Current Page: <b>{{url}}</b>
</div>
<iframe seamless="seamless" frameborder="0"></iframe>
<script>

$(function() {
    window.frames[0].focus();

    var coll = "web";
    var url = "{{ url }}";

    window.setTimeout(function() {
        document.querySelector("iframe").src = "http://{{ vnc_host }}/vnc_auto.html?password=secret";
    }, 1000);

    $("#update").click(function() {
        var ts = $("#ts").val();

        var url = "http://{{ cmd_host }}/set?ts=" + ts;

        $.getJSON(url, function() {
            console.log("Updated Date to " + ts);
            update_state();
        });

        window.frames[0].focus();
    });

    function update_state() {
        var full_url = "/" + coll + "/" + $("#ts").val() + "/" + url;

        window.history.replaceState({}, "", full_url);
    }

    function ping() {
        $.getJSON("http://{{ cmd_host }}/ping", function(data) {
            url = data.url;
            var sec = data.sec;

            $("#currLabel").html("Current Page: <b>" + url + "</b> from <b>" + new Date(sec * 1000).toGMTString() + "</b>");
            
            update_state();
        });
    }

    window.setInterval(ping, 5000);
    ping();
});
</script>
</body>
</html>
